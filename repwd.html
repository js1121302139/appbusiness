<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="css/page/repwd.css">
	</head>

	<body>
		<div id="repwd">
			<header class="mui-bar topBar mui-bar-nav">
				<a class="mui-action-back topBack-ico mui-pull-left"></a>
				<h1 class="mui-title" id="pageTit">忘记密码</h1>
			</header>
			<div class="logoImg">

			</div>
			<div class="mui-content content">
				<div class="loginTop-box">
					<img id="loginLogo" src="img/loginLogo.png">
				</div>
				<div class="login-box">
					<div class="userPhoneNumber mui-input-row input-border">
						<span class="userPhoneNumberIco"></span>
						<input type="number" class="mui-input-clear" @blur="changeUserData('mobile')" v-model.trim="changeInfo.mobile" typeName="phone" name="" id="phoneNum" value="" placeholder="请输入手机号！" />
					</div>
					<div class="userPhoneCode mui-input-row input-border">
						<span class="userPhoneCodeIco"></span>
						<input type="tel" maxlength="6" typeName="code" @blur="changeUserData('messageCode')" v-model.trim="changeInfo.messageCode" name="" id="phoneCode" value="" placeholder="请输入短信验证码！" />
						<button class="phoneCodeNum mui-text-right" @click="smsVerify" :disabled="showOutTime" v-text="second==90?'获取验证码':'剩余'+second+'秒'">获取验证码</button>
					</div>
					<div class="userPwd mui-input-row input-border">
						<span class="userPwdIco"></span>
						<input type="password" class="mui-input-password" @blur="changeUserData('password')" v-model.trim="changeInfo.password" typeName="pwd" name="" id="newPwd" value="" placeholder="请输入新密码！" />
					</div>
				</div>

			</div>
			<div class="sureBtn mui-text-center">
				<button href="javascript:;" @click="changePwd">确定</button>
			</div>
		</div>
		<script src="js/mui.min.js"></script>
		<script type="text/javascript" src="js/muihelper.js"></script>
		<script type="text/javascript" src="js/common.js"></script>
		<script src="js/vue.min.js"></script>
		<script type="text/javascript">
			var Vue = new Vue({
				el: "#repwd",
				data: function() {
					return {
						changeInfo: {
							"password": null,
							"messageCode": null,
							'mobile': null
						},
						timer: null,
						check: new CheckValue(),
						showOutTime: false,
						second: 90
					}
				},
				methods: {
					changeUserData: function(key) {
						clearInterval(this.timer);
						var _this = this;
						switch(key) {
							case "password":
								_this.changeInfo.password = _this.check.checkPwd(_this.changeInfo.password)
								break;
							case "mobile":
								_this.changeInfo.mobile = _this.check.checkPhoneNum(_this.changeInfo.mobile)
								break;
							case "messageCode":
								_this.changeInfo.messageCode = _this.check.checkCode(_this.changeInfo.messageCode)
								break;
						}
					},
					timeOut: function() {
						this.showOutTime = true;
						this.second--;
						if(this.second < 1) {
							this.showOutTime = false;
							this.second = 90;
						} else {
							var timeout = setTimeout(this.timeOut, 1000);
						}
					},
					smsVerify: function() {
						var _this = this;
						var sendData = {
							config: {
								'phone': this.changeInfo.mobile
							},
							fun_Success: function(data) {
								if(data.data) {
									mui.toast(data.message)
									_this.timeOut();
								} else {
									mui.toast(data.message)
								}
							}
						}
						if(this.showOutTime == false && this.changeInfo.mobile != null) {
							mui.plusReady(function() {
								Fun_App.ExAjax("lookpwdSmsSend", sendData);
							})
						} else {
							mui.toast('请输入手机号!');
						}
					},
					changePwd: function() {
						var sendData = {
							config: this.changeInfo,
							fun_Success: function(data) {
								if(data.success) {
									mui.toast('密码修改成功,2秒后跳回登录页面!')
									setTimeout(function() {
										plus.webview.currentWebview().close();
									}, 2500)
								} else {
									mui.toast(data.message)
								}
							}
						}
						Fun_App.checkObjIsNull(this.changeInfo, "") != false ? Fun_App.ExAjax("findPassword", sendData) : mui.toast('还有东西没有填写!')

					}

				}

			})
		</script>
	</body>

</html>