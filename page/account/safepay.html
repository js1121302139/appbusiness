<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<title>兑咖网-修改结算密码</title>
		<link rel="stylesheet" href="../../css/mui.min.css">
		<link rel="stylesheet" href="../../css/page/account/safelogin.css" />

	</head>

	<body>
		<div id="safe">
			<header class="mui-bar topBar mui-bar-nav">
			<a class="mui-action-back topBack-ico mui-pull-left"></a>
			<h1 class="mui-title">修改结算密码</h1>
		</header>
		<div class="mui-content">
			<div class="mine-safe-box">
				<div class="mui-input-group">
					<!--<div class="mui-input-row">
						<input style="width: 60%;float: left;" type="text" placeholder="请输入验证码">
						<img class="codePic" src="../../images/60x60.gif" />
					</div>-->
					<div class="mui-input-group">
						<!--<div class="mui-input-row">
							<input style="width: 60%;float: left;" id="imgCode" type="text" placeholder="请输入验证码">
							<img class="codePic" id="yzmNum" src="" />
						</div>-->
						<div class="mui-input-row">
								<input style="width: 60%;float: left;" type="tel" maxlength="6" v-model="pageData.phoneCode" @blur="checkVal('code',pageData.phoneCode)" id="phoneCode" placeholder="请输入手机验证码">
								<button class="codeBtn mui-btn mui-btn-primary" @click="smsVerify" id="codeButton" :disabled="showOutTime" v-text="second==90?'获取验证码':'剩余'+second+'秒'">获取验证码</button>
							</div>
							<div class="mui-input-row">
								<input type="password" id="newPwd" v-model="pageData.newPwd" @blur="checkVal('pwd',pageData.newPwd)" placeholder="请输入新结算密码">
							</div>
						<!--<div class="mui-input-row">
						<input type="text" placeholder="请再次输入新newPwd">
					</div>-->
					</div>
				</div>
				<div class="footerButton mui-text-center" @click="upDataLoginPwd" id="updateBalanceBtn">
					确定
				</div>
			</div>
		</div>
		</div>
		<script type="text/javascript" src="../../js/mui.js"></script>
		<script type="text/javascript" src="../../js/muihelper.js"></script>
		<script type="text/javascript" src="../../js/common.js"></script>
		<!--<script type="text/javascript" src="../../js/page/accounnt/safepay.js" ></script>-->
		<script type="text/javascript" src="../../js/vue.min.js" ></script>
		<script>
			var Vue = new Vue({
				el: "#safe",
				data: function() {
					return {
						pageData: {
							phoneCode: null,
							newPwd: null
						},
						showOutTime: false,
						second: 90,
						checkValue:new CheckValue()
					}
				},
				created: function() {

				},
				methods: {
					checkVal:function(type,val){
						if(type=='code'){							
							this.pageData.phoneCode = this.checkValue.checkCode(val);
						}else{							
							this.pageData.newPwd = this.checkValue.checkPwd(val);
						}
					},
					upDataLoginPwd:function () {
						var sendData = {
							config: {
								"token": Fun_App.getdata("token"),
								"newPwd": this.pageData.newPwd,
								"code":  this.pageData.phoneCode
							},
							fun_Success: function(data) {
								if(data.success) {
									mui.toast("结算密码修改成功!");
									plus.webview.currentWebview().close();
								} else {
									mui.toast(data.message);
								}
							}
						}
						var _this = this ;
						mui.plusReady(function(){
							Fun_App.checkObjIsNull(_this.pageData,"")!=false?Fun_App.ExAjax("merchantPerson/updatebalancepassword", sendData):mui.toast('还有东西没有填写');
						})
						
					},
					timeOut: function() {
						this.showOutTime = true;
						this.second--;
						if(this.second < 1) {
							this.showOutTime = false;
							this.second = 90;
						} else {
							var timeout = setTimeout(this.timeOut, 1000);
						}
					},
					smsVerify: function() {
						var _this = this;
						var sendData = {
							config: {
								token: Fun_App.getdata("token"),
								type: 2
							},
							fun_Success: function(data) {
								if(data.data) {
									_this.timeOut();
									mui.toast(data.message);
								}else{
									mui.toast(data.message);
								}
							}
						}
						if(this.showOutTime == false) {
							mui.plusReady(function() {
								Fun_App.ExAjax("merchant/smsVerify", sendData);
							})
						}
					}
				},
				watch:{
					phoneCode:function(code){
						alert(code)
					}
				}
			})
		</script>
	</body>

</html>