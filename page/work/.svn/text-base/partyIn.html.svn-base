<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="../../css/page/work/partyIn.css" />
	</head>

	<body>
		<div id="partyIn">
			<header class="mui-bar topBar mui-bar-nav">
				<a class="mui-action-back topBack-ico mui-pull-left"></a>
				<h1 class="mui-title mui-ellipsis" id="tit" v-text="pageData.theme"></h1>
				<span id="createPartyRaiders" class="rightIco mui-pull-right" @click="shareShowBox = !shareShowBox"></span>
			</header>
			<div class="partyCardBox">
				<div class="partyCard">
					<div class="partyState">
						<p class="partyStateIco Ico1" id="partyState" v-text="status[pageData.status]"></p>
						<p id="partyStarTime" class="partyStateDate mui-text-right" v-text="strartAndEnd">2017-08-05 18:00-22:00</p>
					</div>
					<div class="partyInPeople mui-text-center">
						<span id="rcNum" v-text="pageData.useNumber"></span>入场
					</div>
					<div class="partyCardFooter">
						<p class="CardFooterMoney" id="CardFooterMoney">单价:￥{{pageData.price}}</p>
						<p class="CardFooterNum" id="CardFooterNum">已售:{{pageData.saleNumber}}/{{pageData.number}} </p>
						<p class="partyClass" id="partyClass" v-text="type[pageData.type]"></p>
					</div>
				</div>
			</div>
			<div class="mui-content">

				<div class="partyArticle" id="partyArticle" v-html="pageData.description">
					<div class="partyArticleTit mui-text-center">
						<span class="partyTit">活动详情</span>
					</div>

				</div>
			</div>
			<div class="mui-backdrop" @click="shareShowBox=!shareShowBox" v-show="shareShowBox"></div>
			<div class="shareShowBox" v-show="shareShowBox">
				<div class="shareShowBoxItem" @click="share(2,'WXSceneTimeline')">
					<div class="shareShowBoxItem-ico wx">

					</div>
					<p>朋友圈</p>
				</div>
				<div class="shareShowBoxItem" @click="share(2,'WXSceneSession')">
					<div class="shareShowBoxItem-ico wxhy">  
					</div>
					<p>微信</p>
				</div>
				<div class="shareShowBoxItem" @click="share(0)">
					<div class="shareShowBoxItem-ico qq">

					</div>
					<p>QQ</p>
				</div>
				<div class="shareShowBoxItem" @click="share(1)">
					<div class="shareShowBoxItem-ico wb">

					</div>
					<p>新浪微博</p>
				</div>
				<div class="shareShowBoxItem">
					<div class="shareShowBoxItem-ico link">

					</div>
					<p>复制链接</p>
				</div>
			</div>
		</div>
		<script src="../../js/mui.min.js"></script>
		<script type="text/javascript" src="../../js/muihelper.js"></script>
		<script src="../../js/vue.min.js"></script>
		<script type="text/javascript">
			var Vue = new Vue({
				el: "#partyIn",
				data: function() {
					return {
						shares: null,
						shareShowBox: false,
						type: {
							'4': '众筹',
							'3': '购票'
						},
						status: {
							'0': '未审核',
							'1': "审核通过",
							'2': "审核不通过",
							"3": '下架',
							"4": "众筹成功",
							"5": "众筹失败",
							"6": '预览'
						},
						arcId: null,
						strartAndEnd:null,
						pageData: {},
						shareServer: null
					}
				},
				created: function() {
					var _this = this;
					mui.plusReady(function() {
						Fun_App.pulldownRefresh();
						console.log(JSON.stringify(Fun_App.getextrasdata()))
						//see代表的是预览
						if(Fun_App.getextrasdata().id != "see") {
							_this.getPartyIn(Fun_App.getextrasdata(), function(resData) {
								_this.pageData = resData.data;
								_this.arcId= resData.data.id;
								_this.strartAndEnd = resData.data.startTime;
								_this.strartAndEnd +=" ~ "+resData.data.endTime.split(" ")[1];
								console.log(JSON.stringify(_this.pageData))
							});
						} else {
							_this.pageData = Fun_App.getextrasdata().data;
						}
						plus.share.getServices(function(s) {
							_this.shareServer = s;
							console.log(JSON.stringify(s))
						}, function(e) {

						})
					})
				},
				methods: {
					getPartyIn: function(id, callBack) {
						var sendData = {
							config: {
								token: Fun_App.getdata("token"),
								id: id
							},
							fun_Success: function(data) {
								callBack(data)
							}
						}
						Fun_App.ExAjax("merchantParty/playKaDetail", sendData)
					},
					share: function(id,name) {
						var arc = this.pageData.description;
						console.log(JSON.stringify(this.shareServer))
						var shareOption = this.shareServer[id];
						var _this = this ;
						shareOption.send({
							title:"我在【兑咖 · 娱乐】— 邀请您参加-"+this.pageData.theme+"-一起咖吃咖玩",
							content: "脱掉你沉重的包袱和躯壳，引爆高潮，无趴不欢，尽在兑咖 · 娱乐",
							href: "http://www.yunduiwang.com/api/resources/html/party.html?id="+_this.arcId+"&from=groupmessage",
							extra: {
								scene: name
							},
							thumbs:["shareLogo.png"]
						}, function() {
							mui.toast("分享成功!");
						}, function(e) {
							mui.toast('分享失败!')
						});
						
					}
				}
				

			})
			mui.init()
		</script>
	</body>

</html>