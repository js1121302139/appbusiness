<!DOCTYPE html>
<html lang="zh">

	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta http-equiv="X-UA-Compatible" content="ie=edge" />
		<title>扫描反馈页面</title>
	</head>
	<style>
		html,
		body,
		div,
		span,
		applet,
		object,
		iframe,
		h1,
		h2,
		h3,
		h4,
		h5,
		h6,
		p,
		blockquote,
		pre,
		a,
		abbr,
		acronym,
		address,
		big,
		cite,
		code,
		del,
		dfn,
		em,
		img,
		ins,
		kbd,
		q,
		s,
		samp,
		small,
		strike,
		strong,
		sub,
		sup,
		tt,
		var,
		b,
		u,
		i,
		center,
		dl,
		dt,
		dd,
		ol,
		ul,
		li,
		fieldset,
		form,
		label,
		legend,
		table,
		caption,
		tbody,
		tfoot,
		thead,
		tr,
		th,
		td,
		article,
		aside,
		canvas,
		details,
		embed,
		figure,
		figcaption,
		footer,
		header,
		hgroup,
		menu,
		nav,
		output,
		ruby,
		section,
		summary,
		time,
		mark,
		audio,
		video {
			margin: 0;
			padding: 0;
			border: 0;
			font-size: 100%;
			font: inherit;
			vertical-align: baseline;
		}
		/* HTML5 display-role reset for older browsers */
		
		article,
		aside,
		details,
		figcaption,
		figure,
		footer,
		header,
		hgroup,
		menu,
		nav,
		section {
			display: block;
		}
		
		body {
			line-height: 1;
		}
		
		ol,
		ul {
			list-style: none;
		}
		
		blockquote,
		q {
			quotes: none;
		}
		
		blockquote:before,
		blockquote:after,
		q:before,
		q:after {
			content: '';
			content: none;
		}
		
		table {
			border-collapse: collapse;
			border-spacing: 0;
		}
		
		html,
		body {
			min-height: 100%;
			height: 100%;
			background: #000;
		}
		
		.isCheck {
			position: relative;
			z-index: 9999;
			display: flex;
			flex: 1;
			align-items: center;
			height: 100%;
			padding: 0 3.90625rem;
			opacity: 0;
			transform: scale(0);
			background: #000;
			transition: all .25s;
		}
		
		.isCheck .isCheckInfo {
			position: relative;
			width: 100%;
			height: 15.75rem;
			padding-top: 1.4375rem;
			background: url(../../images/qrCode-isCheckInfoBg.png);
			background-size: 100% 100%;
			text-align: center;
		}
		
		.isCheck .isCheckInfo .closeisCheck {
			position: absolute;
			right: -31px;
			top: -32px;
			display: block;
			width: 1.375rem;
			height: 1.375rem;
			background: url(../../img/qrCode-isCheckInfoclose.png);
			background-size: 100% 100%;
		}
		
		.isCheck .topIco {
			height: 2.75rem;
			margin-bottom: 1.0625rem;
		}
		
		.isCheck .topIco img {
			width: 2.75rem;
			height: 2.75rem;
			display: inline-block;
		}
		
		.isCheck h1 {
			margin-bottom: 2.4375rem;
			font-size: 2.25rem;
			color: rgba(215, 179, 116, 1);
		}
		
		.isCheck h2 {
			margin-bottom: 0.4375rem;
			font-size: 1rem;
			color: rgba(51, 51, 51, 1);
		}
		
		.isCheck p {
			font-size: 0.6875rem;
			color: rgba(153, 153, 153, 1);
		}
	</style>

	<body>
		<div class="isCheck" id="isCheck">
			<div class="isCheckInfo">
				<a href="Javascript:;" id="closeisCheck" class="closeisCheck"></a>
				<div class="topIco">
					<img src="../../img/qrCode-isSuccessT.png" alt="" />
					<img src="../../img/qrCode-isSuccessF.png" alt="" />
				</div>
				<h1>验证成功</h1>
				<h1>验证失败</h1>
				<h2 id="isCheckName"></h2>
				<p id="isCheckDate"></p>
			</div>
		</div>
	</body>
	<script src="../../js/mui.js"></script>
	<script src="../../js/muihelper.js"></script>
	<script>
		mui.plusReady(function() {
			
			var pageData = Fun_App.getextrasdata();
			console.log(pageData)
			isCheckBox = document.querySelector("#isCheck"), // 大容器
				closeisCheckBox = document.querySelector("#closeisCheck"), // 关闭按钮
				isCheckNameBox = document.querySelector("#isCheckName"), // 套餐名
				isCheckDateBox = document.querySelector("#isCheckDate"); // 套餐有效时间

			// 验证状态的文字图片切换

			function toogleState(state) {
				var h1Box = isCheckBox.querySelectorAll("h1"), // 状态文字
					imgBox = isCheckBox.querySelectorAll("img"); // 状态图
				// 验证成功
				if(state == 0) {
					h1Box[1].style.display = "none";
					imgBox[1].style.display = "none";
				} else {
					h1Box[0].style.display = "none";
					imgBox[0].style.display = "none";
				}
			}
			// 控制状态框

			function toggleCheckBox() {
				var state = (isCheckBox.style.opacity == 1) ? 0 : 1;
				if(state) {
					isCheckBox.style.opacity = "1";
					isCheckBox.style.transform = "scale(1)";
				} else {
					isCheckBox.style.opacity = "0";
					isCheckBox.style.transform = "scale(0)";
				}
			}

			// 改变状态框的文字

			function changeisCheckTxt(name, activDate) {
				isCheckNameBox.innerText = name;
				isCheckDateBox.innerText = activDate;
			}

			// 接口
//plus.webview.close('../qrCode.html', "slide-out-right", 250);
			try {
				pageData = eval('(' + pageData + ')');
				console.log(Object.prototype.toString.call(pageData))
				if(Object.prototype.toString.call(pageData)=="[object Object]"){
					luck(pageData.orderId);
				pkgName(pageData.offerPkgId);
				}else{
					throw Error("err");
				}
			} catch(err) {
				mui.toast('二维码读取错误');
				setTimeout(function() {
					//plus.webview.currentWebview().close("", "slide-out-right", 500);
				}, 500)
			}

			function luck(orderId) {
				var sendData = {
					fun_Success: function(data) {
						
						//var data={"retCode":0,"retMsg":null,"data":null,"reqId":null}
						if(data.retCode == 0) {
							// 显示隐藏状态框 
							toggleCheckBox()
							toogleState(data.retCode);
						} else {
							// 显示隐藏状态框
							toggleCheckBox()
							toogleState(data.retCode);
							mui.toast(data.retMsg);
						}
						plus.webview.close('../qrCode.html', "slide-out-right", 250);
						console.log(data+"luck")
					}
				}
				Fun_App.ExAjax("activity/award/order/check?token=" + Fun_App.getdata("token") + "&orderId=" + orderId, sendData, "GET")
			}

			function pkgName(pkgId) {
				var sendData = {
					fun_Success: function(data) {
						console.log(data+"pkgName")
						changeisCheckTxt(data.data.pkgName, "(有限期:" + data.data.endTime.split(" ")[0] + "前使用)");
					}
				}
				Fun_App.ExAjax("activity/offerpkg/view?offerPkgId="+pkgId, sendData, "GET");
			}
			var orderid = String(pageData.orderId);

			closeisCheckBox.addEventListener('tap', function() {
				toggleCheckBox();
				setTimeout(function() {
					plus.webview.currentWebview().close();
				}, 500)
			})
		})
	</script>

</html>